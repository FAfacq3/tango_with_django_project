{% extends "rango/base.html" %}
{% load static %}

{% block content %}
    <h1>Welcome to Rango</h1>

    {% if user.is_authenticated %}
        <p>Logged in as: {{ user.username }}</p>
    {% else %}
        <p>You are not logged in.</p>
    {% endif %}

    <p>You have visited this site {{ visits }} times.</p>

    <h2>Categories:</h2>
    <ul>
        {% for category in categories %}
            <li>
                {{ category.name }}
                <button class="like-button" data-category-id="{{ category.id }}">üëç Like</button>
                <span id="likes-count-{{ category.id }}">{{ category.likes }}</span> Likes
            </li>
        {% empty %}
            <li>No categories yet.</li>
        {% endfor %}
    </ul>

    <br>
    {% if user.is_authenticated %}
        <a href="{% url 'rango:add_category' %}">Add Category</a>
    {% endif %}


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
    $(document).ready(function() {
        $(".like-button").click(function() {
            var categoryId = $(this).attr("data-category-id");
            var likesCountSpan = $("#likes-count-" + categoryId);

            $.ajax({
                type: "POST",
                url: "{% url 'rango:like_category' %}",
                data: {
                    'category_id': categoryId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                dataType: "json",
                success: function(response) {
                    if (response.status === 'ok') {
                        likesCountSpan.text(response.likes);
                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.log("AJAX Error: ", status, error);
                    alert("Something went wrong. Please try again later.");
                }
            });
        });
    });
    </script>

{% endblock %}
